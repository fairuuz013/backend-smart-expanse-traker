model ActivityLog {
  id          Int      @id @default(autoincrement())
  user_id     String // Foreign Key menjadi String
  action      String   @db.VarChar
  description String?  @db.Text
  created_at  DateTime @default(now()) @db.Timestamp
  user        User     @relation(fields: [user_id], references: [id])
}

model Attachment {
  id             String      @id @default(uuid()) // Diubah ke UUID
  transaction_id String // Foreign Key menjadi String (Transaction UUID)
  file_path      String      @db.VarChar
  file_type      String      @db.VarChar
  created_at     DateTime    @default(now()) @db.Timestamp
  transaction    Transaction @relation(fields: [transaction_id], references: [id], onDelete: Cascade)
}

model Budget {
  id            String   @id @default(uuid()) // Diubah ke UUID
  user_id       String // Foreign Key menjadi String
  monthly_limit Decimal  @db.Decimal
  month_year    DateTime @db.Date
  user          User     @relation(fields: [user_id], references: [id])
}

model Category {
  id           Int           @id @default(autoincrement())
  name         String        @db.VarChar
  icon         String?       @db.VarChar
  type         String        @db.VarChar
  transactions Transaction[]
}

model Notification {
  id         Int      @id @default(autoincrement())
  user_id    String // Foreign Key menjadi String
  title      String   @db.VarChar
  content    String   @db.Text
  is_read    Boolean  @default(false)
  created_at DateTime @default(now()) @db.Timestamp
  user       User     @relation(fields: [user_id], references: [id])
}

model Otp {
  id         Int      @id @default(autoincrement())
  user_id    String // Foreign Key menjadi String
  code       String   @db.VarChar
  type       String   @db.VarChar
  expired_at DateTime @db.Timestamp
  user       User     @relation(fields: [user_id], references: [id])
}

model PasswordReset {
  email      String   @id @db.VarChar
  token      String   @db.VarChar
  created_at DateTime @default(now()) @db.Timestamp
}

model RefreshToken {
  id         Int      @id @default(autoincrement())
  user_id    String // Foreign Key menjadi String
  token      String   @db.VarChar
  expires_at DateTime @db.Timestamp
  user       User     @relation(fields: [user_id], references: [id])
}

model Transaction {
  id               String   @id @default(uuid()) // Diubah ke UUID
  user_id          String // Foreign Key menjadi String
  category_id      Int // Tetap Int sesuai Category
  wallet_id        String // Foreign Key menjadi String (Wallet UUID)
  amount           Decimal  @db.Decimal
  type             String   @db.VarChar
  note             String?  @db.Text
  transaction_date DateTime @db.Timestamp

  wallet      Wallet       @relation(fields: [wallet_id], references: [id])
  category    Category     @relation(fields: [category_id], references: [id])
  attachments Attachment[]

  @@index([user_id])
  @@index([transaction_date])
}

model User {
  id         String   @id @default(uuid()) // Diubah ke UUID
  full_name  String   @db.VarChar
  email      String   @unique @db.VarChar
  password   String   @db.VarChar
  role       String?  @db.VarChar
  created_at DateTime @default(now()) @db.Timestamp

  // Relasi otomatis mengikuti tipe data String
  wallets        Wallet[]
  budgets        Budget[]
  notifications  Notification[]
  otps           Otp[]
  refresh_tokens RefreshToken[]
  activity_logs  ActivityLog[]
}

model Wallet {
  id           String        @id @default(uuid()) // Diubah ke UUID
  user_id      String // Foreign Key menjadi String
  name         String        @db.VarChar
  balance      Decimal       @db.Decimal
  created_at   DateTime      @default(now()) @db.Timestamp
  user         User          @relation(fields: [user_id], references: [id])
  transactions Transaction[]
}

// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../generated"
}

datasource db {
  provider = "postgresql"
}
